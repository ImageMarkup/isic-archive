[tox]
envlist = py36, lint

[testenv]
# TODO: Figure out why per-process tests are necessary in user_test
# numpy is a setup_requires for pylibtiff, this can be removed when pylibtiff generates releases as wheels, see
# https://github.com/pearu/pylibtiff/issues/81
deps = numpy
       pytest
       pytest-girder>=3.0.2
       pytest-xdist
commands =
    pytest --boxed --verbose --showlocals --junitxml={envlogdir}/junit.xml --ignore test/e2e {posargs} test

[testenv:lint]
basepython = python3
skipsdist = true
skip_install = true
deps =
    flake8
    flake8-blind-except
    flake8-bugbear
    flake8-docstrings>=1.3
    # pin pydocstyle for https://gitlab.com/pycqa/flake8-docstrings/issues/36
    pydocstyle<4
    flake8-import-order>=0.9
    flake8-quotes
    pep8-naming
    mypy
    yamllint
commands =
    flake8 .
    mypy --ignore-missing-imports .
    yamllint --config-file ansible/.yamllint .

[testenv:e2e]
deps = numpy
       pytest
       pytest-girder>=3.0.2
       pytest-xdist
commands =
    pytest --boxed --verbose --showlocals --junitxml={envlogdir}/junit.xml {posargs} test/e2e
setenv =
  GIRDER_MONGO_URI = mongodb://mongo:27017/girder

[flake8]
max-line-length = 100
show-source = True
# https://github.com/PyCQA/flake8-import-order
import-order-style = appnexus
application-import-names = isic_archive
application-package-names =
    girder,
    girder_large_image,
    large_image
exclude =
    ansible/roles/girder.girder,
    ansible/roles/girder.mongodb,
    ansible/roles/large_image,
    node_modules,
    .eggs,
    .git,
    .mypy_cache,
    __pycache__,
    .tox
ignore =
    # https://pycodestyle.readthedocs.io/en/latest/intro.html#error-codes
    # closing bracket does not match indentation of opening bracketâ€™s line
    E123
    # line break before binary operator
    W503,

    # https://github.com/PyCQA/pep8-naming
    # function name should be lowercase
    N802,
    # argument name should be lowercase
    N803,
    # variable in function should be lowercase
    N806,
    # lowercase imported as non lowercase
    N812,
    # mixedCase variable in class scope
    N815,
    # mixedCase variable in global scope
    N816,

    # http://www.pydocstyle.org/en/latest/error_codes.html
    # Missing docstring in *
    D10,
